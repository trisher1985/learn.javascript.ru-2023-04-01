<!DOCTYPE html><html lang="ru" data-theme-enabled="1">
<!-- Mirrored from learn.javascript.ru/testing-mocha by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 01 Apr 2023 11:30:50 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><script>window.currentUser = null;</script><script>window.shopCurrency = "RUB";</script><script>window.localCurrency = "RUB";</script><script>window.countryCode = "us";</script><script>window.rateShopTo = {"RUB":1,"EUR":0.011867359644629349,"USD":0.012902150849186668,"AMD":5.012227561892037};</script><title itemprop="name">Автоматическое тестирование c использованием фреймворка Mocha</title><link href="pack/styles.d76a6ae6433f1b0d6d11.css" rel="stylesheet"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes, minimum-scale=1.0"><meta name="apple-mobile-web-app-capable" content="yes"><!-- chrome autotranslate is enabled only for "en" main version--><meta name="google" content="notranslate"><script>if (window.devicePixelRatio > 1) document.cookie = 'pixelRatio=' + window.devicePixelRatio + ';path=/;expires=Tue, 19 Jan 2038 03:14:07 GMT';</script><link href="http://fonts.googleapis.com/css?family=Open+Sans:bold,italic,bolditalic" rel="stylesheet"><link rel="apple-touch-icon-precomposed" href="img/favicon/apple-touch-icon-precomposed.png"><link rel="canonical" href="testing-mocha.html"><meta name="msapplication-TileColor" content="#222A2C"><meta name="msapplication-TileImage" content="/img/favicon/tileicon.png"><link rel="icon" href="img/favicon/favicon.png"><meta itemprop="image" content="https://learn.javascript.ru/img/site_preview_ru_512x512.png"><meta property="og:title" content="Автоматическое тестирование c использованием фреймворка Mocha"><meta property="og:image" content="https://learn.javascript.ru/img/site_preview_ru_1200x630.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="fb:admins" content="100001562528165"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Автоматическое тестирование c использованием фреймворка Mocha"><meta name="twitter:site" content="@iliakan"><meta name="twitter:creator" content="@iliakan"><meta name="twitter:image" content="https://learn.javascript.ru/img/site_preview_ru_512x512.png"><link rel="prev" href="ninja-code.html"><link rel="next" href="polyfills.html"><script>window.GA_ID = "UA-2056213-16";</script><script>window.GTM_ID = 'GTM-WD2DZPG'</script><script>window.YANDEX_METRIKA_ID = 17649010;</script><script>window.GoogleAnalyticsObject="ga",window.ga=function(){window.ga.q.push(arguments)},window.ga.q=[],window.ga.l=Date.now(),ga("create",GA_ID,"auto"),window.GTM_ID&&ga("require",GTM_ID),window.currentUser?ga("set","&uid",currentUser.id):ga("set","anonymizeIp",!0),window.addEventListener("error",function(e){var r=(e.filename||e.errorUrl)+": "+(e.lineno||e.errorLine),n=e.stack||e.error&&e.error.stack;ga("send","exception",{exDescription:e.message+" "+r+" "+n,exFatal:!0})});</script><script src="../www.google-analytics.com/analytics.js" async></script><script>ga('send', 'pageview');</script><script>window.metrika={reachGoal:function(){}},window.yandex_metrika_callbacks=[function(){try{window.metrika=new Ya.Metrika({id:YANDEX_METRIKA_ID,webvisor:!0,clickmap:!0,params:{user:window.currentUser&&window.currentUser.id}}),metrika.trackLinks({delay:150}),window.addEventListener("error",function(r){window.metrika.reachGoal("JSERROR",{src:(r.filename||r.errorUrl)+": "+(r.lineno||r.errorLine),stack:r.stack||r.error&&r.error.stack,message:r.message})})}catch(r){}}];</script><script src="../mc.yandex.ru/metrika/watch.js" async></script><script>window.RECAPTCHA_ID = "6LfmLAEVAAAAAJMykMnf7aY8nkyTRmYi2ynx51R1";</script><script src="pack/init.0a89b5228a4598490ad5.js"></script><script src="pack/head.ccd1a02912f51802640c.js" defer></script><meta property="og:title" content="Автоматическое тестирование c использованием фреймворка Mocha"><meta property="og:type" content="article"><script src="pack/tutorial.f78de0b8b0137f8052dd.js" defer></script><script src="pack/footer.0940b4b40eb12f87e263.js" defer></script></head><body class="no-icons"><script>window.fontTest();</script><div class="page-wrapper page-wrapper_sidebar_on"><!--[if IE]><div style="color:red;text-align:center">Извините, Internet Explorer не поддерживается, пожалуйста используйте более новый браузер.</div><![endif]--><div class="sitetoolbar sitetoolbar_tutorial"><script>window.langs = [{"code":"ar","name":"Arabic"},{"code":"az","name":"Azerbaijani"},{"code":"bg","name":"Bulgarian"},{"code":"bn","name":"Bengali"},{"code":"bs","name":"Bosnian"},{"code":"ca","name":"Catalan"},{"code":"cs","name":"Czech"},{"code":"da","name":"Danish"},{"code":"de","name":"German"},{"code":"el","name":"Greek"},{"code":"en","name":"English"},{"code":"es","name":"Spanish"},{"code":"fa","name":"Persian (Farsi)"},{"code":"fi","name":"Finnish"},{"code":"fr","name":"French"},{"code":"he","name":"Hebrew"},{"code":"hi","name":"Hindi"},{"code":"hr","name":"Croatian"},{"code":"hu","name":"Hungarian"},{"code":"hy","name":"Armenian"},{"code":"id","name":"Indonesian"},{"code":"it","name":"Italian"},{"code":"ja","name":"Japanese"},{"code":"ka","name":"Georgian"},{"code":"kk","name":"Kazakh"},{"code":"km","name":"Central Khmer"},{"code":"ko","name":"Korean"},{"code":"ky","name":"Kyrgyz"},{"code":"lt","name":"Lithuanian"},{"code":"me","name":"Montenegrin"},{"code":"ml","name":"Malayalam"},{"code":"ms","name":"Malay"},{"code":"my","name":"Burmese"},{"code":"nl","name":"Dutch"},{"code":"no","name":"Norvegian"},{"code":"pa","name":"Punjabi"},{"code":"pl","name":"Polish"},{"code":"pt","name":"Portuguese"},{"code":"ro","name":"Romanian"},{"code":"ru","name":"Russian"},{"code":"si","name":"Sinhala"},{"code":"sk","name":"Slovak"},{"code":"sl","name":"Slovenian"},{"code":"sq","name":"Albanian"},{"code":"sr","name":"Serbian"},{"code":"ta","name":"Tamil"},{"code":"te","name":"Telugu"},{"code":"test","name":"Test"},{"code":"th","name":"Thai"},{"code":"tk","name":"Turkmen"},{"code":"tr","name":"Turkish"},{"code":"ug","name":"Uyghur"},{"code":"uk","name":"Ukrainian"},{"code":"ur","name":"Urdu"},{"code":"uz","name":"Uzbek"},{"code":"v2","name":"v2"},{"code":"vi","name":"Vietnamese"},{"code":"zh-hant","name":"Chinese Traditional"},{"code":"zh","name":"Chinese"}];</script><script>window.lang = "ru";</script><script>{let t=navigator.languages||[];t=t.map(t=>t.toLowerCase());let o,i,n=[];for(let o of window.langs)for(let i of t)if(i===o.code||i.startsWith(o.code+"-")){n.push(o);break}if(!o&&"ru"!=lang&&"en"!=lang){n.find(t=>"en"==t.code)&&(o=`\n            According to your browser headers, you know English. Please help to <a href="https://github.com/javascript-tutorial/${lang}.javascript.info#readme">translate the tutorial</a>.\n            Thank you!\n          `,i="notify-translate-tutorial-local")}if(o){let t=`<div class="notification notification_top notification_info sitetoolbar__notification" style="display:none" id="${i}">\n          <div class="notification__content">${o}</div>\n          <button class="notification__close" title="Close"></button>\n        </div>`;document.write(t),showTopNotification()}}</script><div class="sitetoolbar__content"><div class="sitetoolbar__lang-switcher"><button class="sitetoolbar__dropdown-button" data-dropdown-toggler>RU</button><div class="sitetoolbar__dropdown-wrap"><div class="sitetoolbar__dropdown-body"><div class="sitetoolbar__lang-switcher-body"><div class="supported-langs supported-langs_toolbar"><div class="supported-langs__container"><ul class="supported-langs__list" style="height:200px"><li class="supported-langs__item"><a class="supported-langs__link" href="https://ar.javascript.info/testing-mocha"><span class="supported-langs__brief">AR</span><span class="supported-langs__title">عربي</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://javascript.info/testing-mocha"><span class="supported-langs__brief">EN</span><span class="supported-langs__title">English</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://es.javascript.info/testing-mocha"><span class="supported-langs__brief">ES</span><span class="supported-langs__title">Español</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://fa.javascript.info/testing-mocha"><span class="supported-langs__brief">FA</span><span class="supported-langs__title">فارسی</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://fr.javascript.info/testing-mocha"><span class="supported-langs__brief">FR</span><span class="supported-langs__title">Français</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://id.javascript.info/testing-mocha"><span class="supported-langs__brief">ID</span><span class="supported-langs__title">Indonesia</span></a></li></ul><ul class="supported-langs__list" style="height:200px"><li class="supported-langs__item"><a class="supported-langs__link" href="https://it.javascript.info/testing-mocha"><span class="supported-langs__brief">IT</span><span class="supported-langs__title">Italiano</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://ja.javascript.info/testing-mocha"><span class="supported-langs__brief">JA</span><span class="supported-langs__title">日本語</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://ko.javascript.info/testing-mocha"><span class="supported-langs__brief">KO</span><span class="supported-langs__title">한국어</span></a></li><li class="supported-langs__item supported-langs__item_current"><a class="supported-langs__link" href="testing-mocha.html"><span class="supported-langs__brief">RU</span><span class="supported-langs__title">Русский</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://tr.javascript.info/testing-mocha"><span class="supported-langs__brief">TR</span><span class="supported-langs__title">Türkçe</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://uk.javascript.info/testing-mocha"><span class="supported-langs__brief">UK</span><span class="supported-langs__title">Українська</span></a></li></ul><ul class="supported-langs__list" style="height:20px"><li class="supported-langs__item"><a class="supported-langs__link" href="https://zh.javascript.info/testing-mocha"><span class="supported-langs__brief">ZH</span><span class="supported-langs__title">简体中文</span></a></li></ul></div><div class="supported-langs__text">Мы хотим сделать этот проект с открытым исходным кодом доступным для людей во всем мире. Пожалуйста, <a href="https://javascript.info/translate#help" rel="noopener noreferrer" target="_blank">помогите нам перевести</a> это руководство на свой язык</div></div></div></div></div></div><div class="sitetoolbar__logo-wrap"><a class="sitetoolbar__link sitetoolbar__link_logo" href="index.html"><img class="sitetoolbar__logo sitetoolbar__logo_normal" src="img/sitetoolbar__logo_ru.svg" width="171" alt="" role="presentation"/><img class="sitetoolbar__logo sitetoolbar__logo_normal sitetoolbar__logo_dark" src="img/sitetoolbar__logo_ru-white.svg" width="171" alt="" role="presentation"/><img class="sitetoolbar__logo sitetoolbar__logo_small" src="img/sitetoolbar__logo_small_ru.svg" width="80" alt="" role="presentation"/><img class="sitetoolbar__logo sitetoolbar__logo_small sitetoolbar__logo_dark" src="img/sitetoolbar__logo_small_ru-white.svg" width="80" alt="" role="presentation"/><script>Array.prototype.forEach.call(document.querySelectorAll("img.sitetoolbar__logo"),function(e){let t=document.createElement("object");t.type="image/svg+xml",t.className=e.className,t.style.cssText="left:0;top:0;position:absolute",t.onload=function(){t.onload=null,e.style.visibility="hidden"},t.data=e.src,e.parentNode.insertBefore(t,e)});</script></a></div><div class="sitetoolbar__nav-toggle-wrap"><button class="sitetoolbar__nav-toggle" type="button"></button></div><nav class="sitetoolbar__sections"><ul class="sitetoolbar__sections-list"><li class="sitetoolbar__section sitetoolbar__section_current"><a class="sitetoolbar__link" href="index.html">Учебник</a></li><li class="sitetoolbar__section"><a class="sitetoolbar__link" href="courses.html">Курсы</a></li><li class="sitetoolbar__section"><a class="sitetoolbar__link" href="https://javascript.ru/forum/">Форум</a></li><li class="sitetoolbar__section"><a class="sitetoolbar__link" href="quiz.html">Тесты знаний</a></li><li class="sitetoolbar__section sitetoolbar__section_dropdown"><button class="sitetoolbar__dropdown-button" data-dropdown-toggler>Скринкасты</button><div class="sitetoolbar__dropdown-wrap"><div class="sitetoolbar__dropdown-body"><ul class="sitetoolbar__dropdown-items"><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="screencast/nodejs.html">Node.js</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="screencast/webpack.html">Webpack</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="screencast/gulp.html">Gulp</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="screencast/react.html">React.js</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="screencast/angular.html">Angular</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="https://youtu.be/W4hoc24K93E?list=PLDyvV36pndZFHXjXuwA_NywNrVQO0aQqb">Git: курс</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="https://youtu.be/lHacJuru1bc?list=PLDyvV36pndZEB7kWWocU4QSn-G78LoaEE">Git: разное</a></li></ul></div></div></li></ul></nav><div class="sitetoolbar__right-button-wrap"><a class="sitetoolbar-right-button sitetoolbar-right-button_courses" href="ebook.html"><span class="sitetoolbar-right-button__extra-text">Купить</span><span class="sitetoolbar-right-button__text">EPUB/PDF</span></a></div><div class="sitetoolbar__login-wrap"><button class="sitetoolbar__login sitetoolbar__login_unready" data-action-login></button></div><div class="sitetoolbar__theme-switcher"><div class="theme-changer"><label class="theme-changer__label" for="theme-changer-input" data-tooltip="Сменить тему оформления"><input class="theme-changer__input" type="checkbox" id="theme-changer-input" data-theme-changer="data-theme-changer"/><span class="theme-changer__icon theme-changer__icon_light-theme"></span><span class="theme-changer__icon theme-changer__icon_dark-theme"></span></label></div></div><div class="sitetoolbar__search-wrap"><div class="sitetoolbar__search-content"><button class="sitetoolbar__search-toggle" type="button"></button><form class="sitetoolbar__search" method="GET" action="https://learn.javascript.ru/search"><div class="sitetoolbar__search-input"><div class="text-input"><input class="text-input__control" name="query" placeholder="Искать на Javascript.ru" required="required" type="text"/></div><button class="sitetoolbar__find" type="submit">Найти</button></div></form></div></div></div><div class="tablet-menu"><div class="tablet-menu__line"><div class="tablet-menu__content"><select class="tablet-menu__nav input-select input-select input-select_small" onchange="if(this.value) window.location.href=this.value"><option value="/" selected>Учебник</option><option value="/courses">Курсы</option><option value="https://javascript.ru/forum/">Форум</option><option value="/quiz">Тесты знаний</option></select></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><form class="tablet-menu-search" action="https://learn.javascript.ru/search/"><input class="tablet-menu-search__input" type="search" name="query" placeholder="Поиск в учебнике" required="required"/><button class="tablet-menu-search__button" type="submit" name="type" value="articles">Поиск</button></form></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><a class="map" href="tutorial/map.html" data-action="tutorial-map"><span class="map__text">Карта учебника</span></a></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><div class="theme-changer theme-changer_tablet-menu theme-changer_has-label"><label class="theme-changer__label" for="theme-changer-input-tablet" data-tooltip="Сменить тему оформления"><input class="theme-changer__input" type="checkbox" id="theme-changer-input-tablet" data-theme-changer="data-theme-changer"/><span class="theme-changer__icon theme-changer__icon_light-theme"></span><span class="theme-changer__icon theme-changer__icon_dark-theme"></span><span class="theme-changer__label-text theme-changer__label-text_light-theme">Светлая тема</span><span class="theme-changer__label-text theme-changer__label-text_dark-theme">Тёмная тема</span></label></div></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><div class="share-icons"><span class="share-icons__title">Поделиться</span><a class="share share_tw" href="https://twitter.com/share?url=https%3A%2F%2Flearn.javascript.ru%2Ftesting-mocha" rel="nofollow"></a><a class="share share_fb" href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=https%3A%2F%2Flearn.javascript.ru%2Ftesting-mocha" rel="nofollow"></a><a class="share share_vk" href="https://vkontakte.ru/share.php?url=https%3A%2F%2Flearn.javascript.ru%2Ftesting-mocha" rel="nofollow"></a></div></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><select class="tablet-menu__nav input-select input-select input-select_small" onchange="if(this.value) window.location.href=this.value"><option value="https://ar.javascript.info/testing-mocha">عربي</option><option value="https://javascript.info/testing-mocha">English</option><option value="https://es.javascript.info/testing-mocha">Español</option><option value="https://fa.javascript.info/testing-mocha">فارسی</option><option value="https://fr.javascript.info/testing-mocha">Français</option><option value="https://id.javascript.info/testing-mocha">Indonesia</option><option value="https://it.javascript.info/testing-mocha">Italiano</option><option value="https://ja.javascript.info/testing-mocha">日本語</option><option value="https://ko.javascript.info/testing-mocha">한국어</option><option value="https://learn.javascript.ru/testing-mocha" selected>Русский</option><option value="https://tr.javascript.info/testing-mocha">Türkçe</option><option value="https://uk.javascript.info/testing-mocha">Українська</option><option value="https://zh.javascript.info/testing-mocha">简体中文</option></select></div></div></div><progress class="tutorial-progress" data-sticky value="27" max="95" data-tooltip="Урок 27 из 95"></progress></div><div class="page page_sidebar_on page_inner_padding"><script>if(localStorage.noSidebar){document.querySelector(".page").classList.remove("page_sidebar_on");let e=document.querySelector(".page-wrapper");e&&e.classList.remove("page-wrapper_sidebar_on")}setTimeout(function(){document.querySelector(".page").classList.add("page_sidebar-animation-on")});</script><div class="page__inner"><main class="main main_width-limit"><header class="main__header"><div class="main__header-inner"><div class="main__header-group"><ol class="breadcrumbs"><li class="breadcrumbs__item breadcrumbs__item_home"><a class="breadcrumbs__link" href="index.html"><span class="breadcrumbs__hidden-text">Учебник</span></a></li><li class="breadcrumbs__item" id="breadcrumb-1"><a class="breadcrumbs__link" href="js.html"><span>Язык JavaScript</span></a></li><li class="breadcrumbs__item" id="breadcrumb-2"><a class="breadcrumbs__link" href="code-quality.html"><span>Качество кода</span></a></li><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Учебник","item":"https://learn.javascript.ru/"},{"@type":"ListItem","position":2,"name":"Язык JavaScript","item":"https://learn.javascript.ru/js"},{"@type":"ListItem","position":3,"name":"Качество кода","item":"https://learn.javascript.ru/code-quality"}]}</script></ol><div class="updated-at" data-tooltip="Последнее обновление: 7 июня 2022 г."><div class="updated-at__content">7 июня 2022 г.</div></div></div><h1 class="main__header-title">Автоматическое тестирование c использованием фреймворка Mocha</h1></div></header><div class="content"><article class="formatted" itemscope itemtype="http://schema.org/TechArticle"><meta itemprop="name" content="Автоматическое тестирование c использованием фреймворка Mocha"><div itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="email" content="iliakan@gmail.com"><meta itemprop="name" content="Ilya Kantor"></div><div itemprop="articleBody"><p>Далее у нас будут задачи, для проверки которых используется автоматическое тестирование. Также его часто применяют в реальных проектах.</p>
<h2><a class="main__anchor" name="zachem-nam-nuzhny-testy" href="#zachem-nam-nuzhny-testy">Зачем нам нужны тесты?</a></h2><p>Обычно, когда мы пишем функцию, мы легко можем представить, что она должна делать, и как она будет вести себя в зависимости от переданных параметров.</p>
<p>Во время разработки мы можем проверить правильность работы функции, просто вызвав её, например, из консоли и сравнив полученный результат с ожидаемым.</p>
<p>Если функция работает не так, как мы ожидаем, то можно внести исправления в код и запустить её ещё раз. Так можно повторять до тех пор, пока функция не станет работать так, как нам нужно.</p>
<p>Однако, такие «ручные перезапуски» – не лучшее решение.</p>
<p><strong>При тестировании кода ручными перезапусками легко упустить что-нибудь важное.</strong></p>
<p>Например, мы работаем над функцией <code>f</code>. Написали часть кода и решили протестировать. Выясняется, что <code>f(1)</code> работает правильно, в то время как <code>f(2)</code> – нет. Мы вносим в код исправления, и теперь <code>f(2)</code> работает правильно. Вроде бы, всё хорошо, не так ли? Однако, мы забыли заново протестировать <code>f(1)</code>. Возможно, после внесения правок <code>f(1)</code> стала работать неправильно.</p>
<p>Это – типичная ситуация. Во время разработки мы учитываем множество различных сценариев использования. Но сложно ожидать, что программист станет вручную проверять каждый из них после любого изменения кода. Поэтому легко исправить что-то одно и при этом сломать что-то другое.</p>
<p><strong>Автоматическое тестирование означает, что тесты пишутся отдельно, в дополнение к коду. Они по-разному запускают наши функции и сравнивают результат с ожидаемым.</strong></p>
<h2><a class="main__anchor" name="behavior-driven-development-bdd" href="#behavior-driven-development-bdd">Behavior Driven Development (BDD)</a></h2><p>Давайте начнём с техники под названием <a href="https://ru.wikipedia.org/wiki/BDD_(программирование)">Behavior Driven Development</a> или, коротко, BDD.</p>
<p><strong>BDD – это три в одном: и тесты, и документация, и примеры использования.</strong></p>
<p>Чтобы понять BDD – рассмотрим практический пример разработки.</p>
<h2><a class="main__anchor" name="razrabotka-funktsii-vozvedeniya-v-stepen--pow-spetsifikatsiya" href="#razrabotka-funktsii-vozvedeniya-v-stepen--pow-spetsifikatsiya">Разработка функции возведения в степень — «pow»: спецификация</a></h2><p>Допустим, мы хотим написать функцию <code>pow(x, n)</code>, которая возводит <code>x</code> в целочисленную степень <code>n</code>. Мы предполагаем, что <code>n≥0</code>.</p>
<p>Эта задача взята в качестве примера. В JavaScript есть оператор <code>**</code>, который служит для возведения в степень. Мы сосредоточимся на процессе разработки, который также можно применять и для более сложных задач.</p>
<p>Перед тем, как начать писать код функции <code>pow</code>, мы можем представить себе, что она должна делать, и описать её.</p>
<p>Такое описание называется <em>спецификацией</em> (specification). Она содержит описания различных способов использования и тесты для них, например:</p>
<div id="awq3lkufl5" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>describe(&quot;pow&quot;, function() {

  it(&quot;возводит в степень n&quot;, function() {
    assert.equal(pow(2, 3), 8);
  });

});</code></pre>
        </div>
      </div>
      
      </div><p>Спецификация состоит из трёх основных блоков:</p>
<dl>
<dt><code>describe(&quot;заголовок&quot;, function() { ... })</code></dt>
<dd>
<p>Какую функциональность мы описываем. В нашем случае мы описываем функцию <code>pow</code>. Используется для группировки рабочих лошадок – блоков <code>it</code>.</p>
</dd>
<dt><code>it(&quot;описание&quot;, function() { ... })</code></dt>
<dd>
<p>В первом аргументе блока <code>it</code> мы <em>человеческим языком</em> описываем конкретный способ использования функции, а во втором – пишем функцию, которая тестирует данный случай.</p>
</dd>
<dt><code>assert.equal(value1, value2)</code></dt>
<dd>
<p>Код внутри блока <code>it</code>, если функция работает верно, должен выполняться без ошибок.</p>
<p>Функции вида <code>assert.*</code> используются для проверки того, что функция <code>pow</code> работает так, как мы ожидаем. В этом примере мы используем одну из них – <code>assert.equal</code>, которая сравнивает переданные значения и выбрасывает ошибку, если они не равны друг другу. Существуют и другие типы сравнений и проверок, которые мы добавим позже.</p>
</dd>
</dl>
<p>Спецификация может быть запущена, и при этом будет выполнена проверка, указанная в блоке <code>it</code>, мы увидим это позднее.</p>
<h2><a class="main__anchor" name="protsess-razrabotki" href="#protsess-razrabotki">Процесс разработки</a></h2><p>Процесс разработки обычно выглядит следующим образом:</p>
<ol>
<li>Пишется начальная спецификация с тестами, проверяющими основную функциональность.</li>
<li>Создаётся начальная реализация.</li>
<li>Для запуска тестов мы используем фреймворк <a href="https://mochajs.org/">Mocha</a> (подробнее о нём чуть позже). Пока функция не готова, будут ошибки. Вносим изменения до тех пор, пока всё не начнёт работать так, как нам нужно.</li>
<li>Теперь у нас есть правильно работающая начальная реализация и тесты.</li>
<li>Мы добавляем новые способы использования в спецификацию, возможно, ещё не реализованные в тестируемом коде. Тесты начинают «падать» (выдавать ошибки).</li>
<li>Возвращаемся на шаг 3, дописываем реализацию до тех пор, пока тесты не начнут завершаться без ошибок.</li>
<li>Повторяем шаги 3-6, пока требуемая функциональность не будет готова.</li>
</ol>
<p>Таким образом, разработка проходит <em>итеративно</em>. Мы пишем спецификацию, реализуем её, проверяем, что тесты выполняются без ошибок, пишем ещё тесты, снова проверяем, что они проходят и т.д.</p>
<p>Давайте посмотрим этот поток разработки на нашем примере.</p>
<p>Первый шаг уже завершён. У нас есть спецификация для функции <code>pow</code>. Теперь, перед тем, как писать реализацию, давайте подключим библиотеки для пробного запуска тестов, просто чтобы убедиться, что тесты работают (разумеется, они завершатся ошибками).</p>
<h2><a class="main__anchor" name="spetsifikatsiya-v-deystvii" href="#spetsifikatsiya-v-deystvii">Спецификация в действии</a></h2><p>В этой главе мы будем пользоваться следующими JavaScript-библиотеками для тестов:</p>
<ul>
<li><a href="https://mochajs.org/">Mocha</a> – основной фреймворк. Он предоставляет общие функции тестирования, такие как <code>describe</code> и <code>it</code>, а также функцию запуска тестов.</li>
<li><a href="https://chaijs.com/">Chai</a> – библиотека, предоставляющая множество функций проверки утверждений. Пока мы будем использовать только <code>assert.equal</code>.</li>
<li><a href="https://sinonjs.org/">Sinon</a> – библиотека, позволяющая наблюдать за функциями, эмулировать встроенные функции и многое другое. Нам она пригодится позднее.</li>
</ul>
<p>Эти библиотеки подходят как для тестирования внутри браузера, так и на стороне сервера. Мы рассмотрим вариант с браузером.</p>
<p>Полная HTML-страница с этими библиотеками и спецификацией функции <code>pow</code>:</p>
<div id="nk3s1zwh9a" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-markup"><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;!-- добавим стили mocha для отображения результатов --&gt;
  &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/mocha/3.2.0/mocha.css&quot;&gt;
  &lt;!-- добавляем сам фреймворк mocha --&gt;
  &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/mocha/3.2.0/mocha.js&quot;&gt;&lt;/script&gt;
  &lt;script&gt;
    // включаем режим тестирования в стиле BDD
    mocha.setup('bdd');
  &lt;/script&gt;
  &lt;!-- добавим chai --&gt;
  &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/chai/3.5.0/chai.js&quot;&gt;&lt;/script&gt;
  &lt;script&gt;
    // chai предоставляет большое количество функций. Объявим assert глобально
    let assert = chai.assert;
  &lt;/script&gt;
&lt;/head&gt;

&lt;body&gt;

  &lt;script&gt;
    function pow(x, n) {
      /* Здесь будет реализация функции, пока пусто */
    }
  &lt;/script&gt;

  &lt;!-- скрипт со спецификацией (describe, it...) --&gt;
  &lt;script src=&quot;test.js&quot;&gt;&lt;/script&gt;

  &lt;!-- элемент с id=&quot;mocha&quot; будет содержать результаты тестов --&gt;
  &lt;div id=&quot;mocha&quot;&gt;&lt;/div&gt;

  &lt;!-- запускаем тесты! --&gt;
  &lt;script&gt;
    mocha.run();
  &lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;</code></pre>
        </div>
      </div>
      
      </div><p>Условно страницу можно разделить на пять частей:</p>
<ol>
<li>Тег <code>&lt;head&gt;</code> содержит сторонние библиотеки и стили для тестов.</li>
<li>Тег <code>&lt;script&gt;</code> содержит тестируемую функцию, в нашем случае – <code>pow</code>.</li>
<li>Тесты – в нашем случае внешний скрипт <code>test.js</code>, который содержит спецификацию <code>describe(&quot;pow&quot;, ...)</code>, представленную выше.</li>
<li>HTML-элемент <code>&lt;div id=&quot;mocha&quot;&gt;</code> будет использован фреймворком Mocha для вывода результатов тестирования.</li>
<li>Запуск тестов производится командой <code>mocha.run()</code>.</li>
</ol>
<p>Результаты:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        <a href="https://plnkr.co/edit/jIs05hwEnzt5ljQc?p=preview" target="_blank" title="открыть в песочнице"
        data-plunk-id="jIs05hwEnzt5ljQc" class="toolbar__button toolbar__button_edit"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:250px" src="https://ru.js.cx/article/testing-mocha/pow-1/"></iframe>
  </div><p>Пока что тест завершается ошибкой. Это логично, потому что у нас пустая функция <code>pow</code>, так что <code>pow(2,3)</code> возвращает <code>undefined</code> вместо <code>8</code>.</p>
<p>На будущее отметим, что существуют более высокоуровневые фреймворки для тестирования, такие как <a href="https://karma-runner.github.io/">karma</a> и другие. С их помощью легко сделать автозапуск множества тестов.</p>
<h2><a class="main__anchor" name="nachalnaya-realizatsiya" href="#nachalnaya-realizatsiya">Начальная реализация</a></h2><p>Давайте напишем простую реализацию функции <code>pow</code>, чтобы пройти тесты.</p>
<div id="nkn2qre9lz" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>function pow(x, n) {
  return 8; // :) сжульничаем!
}</code></pre>
        </div>
      </div>
      
      </div><p>Вау, теперь всё работает!</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        <a href="https://plnkr.co/edit/HuZ4IY63WeDHXGdR?p=preview" target="_blank" title="открыть в песочнице"
        data-plunk-id="HuZ4IY63WeDHXGdR" class="toolbar__button toolbar__button_edit"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:250px" src="https://ru.js.cx/article/testing-mocha/pow-min/"></iframe>
  </div><h2><a class="main__anchor" name="uluchshaem-spetsifikatsiyu" href="#uluchshaem-spetsifikatsiyu">Улучшаем спецификацию</a></h2><p>Конечно, мы сжульничали. Функция не работает. Попытка посчитать <code>pow(3, 3)</code> даст некорректный результат, однако тесты проходят.</p>
<p>…Такая ситуация вполне типична, она случается на практике. Тесты проходят, но функция работает неправильно. Наша спецификация не идеальна. Нужно дополнить её тестами.</p>
<p>Давайте добавим ещё один тест, чтобы посмотреть, что <code>pow(3, 3) = 27</code>.</p>
<p>У нас есть два пути организации тестов:</p>
<ol>
<li>
<p>Первый – добавить ещё один <code>assert</code> в существующий <code>it</code>:</p>
<div id="q6vm6dq656" data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:4,&quot;end&quot;:4}]">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>describe(&quot;pow&quot;, function() {

  it(&quot;возводит число в степень n&quot;, function() {
    assert.equal(pow(2, 3), 8);
    assert.equal(pow(3, 3), 27);
  });

});</code></pre>
        </div>
      </div>
      
      </div></li>
<li>
<p>Второй – написать два теста:</p>
<div id="46f72twznx" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>describe(&quot;pow&quot;, function() {

  it(&quot;2 в степени 3 будет 8&quot;, function() {
    assert.equal(pow(2, 3), 8);
  });

  it(&quot;3 в степени 3 будет 27&quot;, function() {
    assert.equal(pow(3, 3), 27);
  });

});</code></pre>
        </div>
      </div>
      
      </div></li>
</ol>
<p>Принципиальная разница в том, что когда один из <code>assert</code> выбрасывает ошибку, то выполнение <code>it</code> блока тут же прекращается. Таким образом, если первый <code>assert</code> выбросит ошибку, результат работы второго <code>assert</code> мы уже не узнаем.</p>
<p>Разделять тесты предпочтительнее, так как мы получаем больше информации о том, что конкретно пошло не так.</p>
<p>Помимо этого есть одно хорошее правило, которому стоит следовать.</p>
<p><strong>Один тест проверяет одну вещь.</strong></p>
<p>Если вы посмотрите на тест и увидите в нём две независимые проверки, то такой тест лучше разделить на два более простых.</p>
<p>Давайте продолжим со вторым вариантом.</p>
<p>Результаты:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        <a href="https://plnkr.co/edit/bkVPLKh4CGlMz8LI?p=preview" target="_blank" title="открыть в песочнице"
        data-plunk-id="bkVPLKh4CGlMz8LI" class="toolbar__button toolbar__button_edit"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:250px" src="https://ru.js.cx/article/testing-mocha/pow-2/"></iframe>
  </div><p>Как мы и ожидали, второй тест провалился. Естественно, наша функция всегда возвращает <code>8</code>, в то время как <code>assert</code> ожидает <code>27</code>.</p>
<h2><a class="main__anchor" name="uluchshaem-realizatsiyu" href="#uluchshaem-realizatsiyu">Улучшаем реализацию</a></h2><p>Давайте напишем что-то более похожее на функцию возведения в степень, чтобы заставить тесты проходить.</p>
<div id="sdllbbdmd1" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>function pow(x, n) {
  let result = 1;

  for (let i = 0; i &lt; n; i++) {
    result *= x;
  }

  return result;
}</code></pre>
        </div>
      </div>
      
      </div><p>Чтобы убедиться, что эта реализация работает нормально, давайте протестируем её на большем количестве значений. Чтобы не писать вручную каждый блок <code>it</code>, мы можем генерировать их в цикле <code>for</code>:</p>
<div id="qfaqts0b6g" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>describe(&quot;pow&quot;, function() {

  function makeTest(x) {
    let expected = x * x * x;
    it(`${x} в степени 3 будет ${expected}`, function() {
      assert.equal(pow(x, 3), expected);
    });
  }

  for (let x = 1; x &lt;= 5; x++) {
    makeTest(x);
  }

});</code></pre>
        </div>
      </div>
      
      </div><p>Результат:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        <a href="https://plnkr.co/edit/wkhH774xLQPfpbns?p=preview" target="_blank" title="открыть в песочнице"
        data-plunk-id="wkhH774xLQPfpbns" class="toolbar__button toolbar__button_edit"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:250px" src="https://ru.js.cx/article/testing-mocha/pow-3/"></iframe>
  </div><h2><a class="main__anchor" name="vlozhennye-bloki-describe" href="#vlozhennye-bloki-describe">Вложенные блоки describe</a></h2><p>Мы собираемся добавить больше тестов. Однако, перед этим стоит сгруппировать вспомогательную функцию <code>makeTest</code> и цикл <code>for</code>. Нам не нужна функция <code>makeTest</code> в других тестах, она нужна только в цикле <code>for</code>. Её предназначение – проверить, что <code>pow</code> правильно возводит число в заданную степень.</p>
<p>Группировка производится вложенными блоками <code>describe</code>:</p>
<div id="uqecl3h8gn" data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:15,&quot;end&quot;:15},{&quot;start&quot;:2,&quot;end&quot;:2}]">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>describe(&quot;pow&quot;, function() {

  describe(&quot;возводит x в степень 3&quot;, function() {

    function makeTest(x) {
      let expected = x * x * x;
      it(`${x} в степени 3 будет ${expected}`, function() {
        assert.equal(pow(x, 3), expected);
      });
    }

    for (let x = 1; x &lt;= 5; x++) {
      makeTest(x);
    }

  });

  // ... другие тесты. Можно писать и describe, и it блоки.
});</code></pre>
        </div>
      </div>
      
      </div><p>Вложенные <code>describe</code> образуют новую подгруппу тестов. В результатах мы можем видеть дополнительные отступы в названиях.</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        <a href="https://plnkr.co/edit/jhMPeQaUhLLiCxnJ?p=preview" target="_blank" title="открыть в песочнице"
        data-plunk-id="jhMPeQaUhLLiCxnJ" class="toolbar__button toolbar__button_edit"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:250px" src="https://ru.js.cx/article/testing-mocha/pow-4/"></iframe>
  </div><p>В будущем мы можем написать новые <code>it</code> и <code>describe</code> блоки на верхнем уровне со своими собственными вспомогательными функциями. Им не будет доступна функция <code>makeTest</code> из примера выше.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type"><code>before/after</code> и <code>beforeEach/afterEach</code></span></div>
            <div class="important__content"><p>Мы можем задать <code>before/after</code> функции, которые будут выполняться до/после тестов, а также функции <code>beforeEach/afterEach</code>, выполняемые до/после <em>каждого</em> <code>it</code>.</p>
<p>Например:</p>
<div id="jy2p7rcyin" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>describe(&quot;тест&quot;, function() {

  before(() =&gt; alert(&quot;Тестирование началось – перед тестами&quot;));
  after(() =&gt; alert(&quot;Тестирование закончилось – после всех тестов&quot;));

  beforeEach(() =&gt; alert(&quot;Перед тестом – начинаем выполнять тест&quot;));
  afterEach(() =&gt; alert(&quot;После теста – заканчиваем выполнение теста&quot;));

  it('тест 1', () =&gt; alert(1));
  it('тест 2', () =&gt; alert(2));

});</code></pre>
        </div>
      </div>
      
      </div><p>Порядок выполнения будет таким:</p>
<div id="mh8811byku" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-none"><code>Тестирование началось – перед тестами (before)
Перед тестом – начинаем выполнять тест (beforeEach)
1
После теста – заканчиваем выполнение теста (afterEach)
Перед тестом – начинаем выполнять тест (beforeEach)
2
После теста – заканчиваем выполнение теста (afterEach)
Тестирование закончилось – после всех тестов (after)</code></pre>
        </div>
      </div>
      
      </div><a class="edit" target="_blank" href="https://plnkr.co/edit/BvndIFoLucB490K0?p=preview">Открыть пример в песочнице.</a><p>Обычно <code>beforeEach/afterEach</code> и <code>before/after</code> используются для инициализации, обнуления счётчиков или чего-нибудь ещё между тестами (или группами тестов).</p>
</div></div>
<h2><a class="main__anchor" name="rasshirenie-spetsifikatsii" href="#rasshirenie-spetsifikatsii">Расширение спецификации</a></h2><p>Основная функциональность <code>pow</code> реализована. Первая итерация разработки завершена. Когда мы закончим отмечать и пить шампанское, давайте продолжим работу и улучшим <code>pow</code>.</p>
<p>Как было сказано, функция <code>pow(x, n)</code> предназначена для работы с целыми положительными значениями <code>n</code>.</p>
<p>Для обозначения математических ошибок функции JavaScript обычно возвращают <code>NaN</code>. Давайте делать также для некорректных значений <code>n</code>.</p>
<p>Сначала давайте опишем это поведение в спецификации.</p>
<div id="7xzbgjwkw8" data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:9,&quot;end&quot;:9},{&quot;start&quot;:5,&quot;end&quot;:5}]">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>describe(&quot;pow&quot;, function() {

  // ...

  it(&quot;для отрицательных n возвращает NaN&quot;, function() {
    assert.isNaN(pow(2, -1));
  });

  it(&quot;для дробных n возвращает NaN&quot;, function() {
    assert.isNaN(pow(2, 1.5));
  });

});</code></pre>
        </div>
      </div>
      
      </div><p>Результаты с новыми тестами:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        <a href="https://plnkr.co/edit/Ba631CmRkYp333yJ?p=preview" target="_blank" title="открыть в песочнице"
        data-plunk-id="Ba631CmRkYp333yJ" class="toolbar__button toolbar__button_edit"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:530px" src="https://ru.js.cx/article/testing-mocha/pow-nan/"></iframe>
  </div><p>Новые тесты падают, потому что наша реализация не поддерживает их. Так работает BDD. Сначала мы добавляем тесты, которые падают, а уже потом пишем под них реализацию.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Другие функции сравнения</span></div>
            <div class="important__content"><p>Обратите внимание на <code>assert.isNaN</code>. Это проверка того, что переданное значение равно <code>NaN</code>.</p>
<p>Библиотека <a href="https://chaijs.com/">Chai</a> содержит множество других подобных функций, например:</p>
<ul>
<li><code>assert.equal(value1, value2)</code> – проверяет равенство  <code>value1 == value2</code>.</li>
<li><code>assert.strictEqual(value1, value2)</code> – проверяет строгое равенство <code>value1 === value2</code>.</li>
<li><code>assert.notEqual</code>, <code>assert.notStrictEqual</code> – проверяет неравенство и строгое неравенство соответственно.</li>
<li><code>assert.isTrue(value)</code> – проверяет, что <code>value === true</code></li>
<li><code>assert.isFalse(value)</code> – проверяет, что <code>value === false</code></li>
<li>…с полным списком можно ознакомиться в <a href="https://chaijs.com/api/assert/">документации</a></li>
</ul>
</div></div>
<p>Итак, нам нужно добавить пару строчек в функцию <code>pow</code>:</p>
<div id="83fr4jkg7w" data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:1,&quot;end&quot;:2}]">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>function pow(x, n) {
  if (n &lt; 0) return NaN;
  if (Math.round(n) != n) return NaN;

  let result = 1;

  for (let i = 0; i &lt; n; i++) {
    result *= x;
  }

  return result;
}</code></pre>
        </div>
      </div>
      
      </div><p>Теперь работает, все тесты проходят:</p>
<div class="code-result">
    <div class="code-result__toolbar toolbar"><div class="toolbar__tool">
        <a href="https://plnkr.co/edit/yOXxvGChgheXAAmF?p=preview" target="_blank" title="открыть в песочнице"
        data-plunk-id="yOXxvGChgheXAAmF" class="toolbar__button toolbar__button_edit"></a>
      </div>
      </div>
    <iframe class="code-result__iframe" data-trusted="1" style="height:300px" src="https://ru.js.cx/article/testing-mocha/pow-full/"></iframe>
  </div><a class="edit" target="_blank" href="https://plnkr.co/edit/yOXxvGChgheXAAmF?p=preview">Открыть готовый пример в песочнице.</a><h2><a class="main__anchor" name="itogo" href="#itogo">Итого</a></h2><p>В BDD сначала пишут спецификацию, а потом реализацию. В конце у нас есть и то, и другое.</p>
<p>Спецификацию можно использовать тремя способами:</p>
<ol>
<li>Как <strong>Тесты</strong> – они гарантируют, что функция работает правильно.</li>
<li>Как <strong>Документацию</strong> – заголовки блоков <code>describe</code> и <code>it</code> описывают поведение функции.</li>
<li>Как <strong>Примеры</strong> – тесты, по сути, являются готовыми примерами использования функции.</li>
</ol>
<p>Имея спецификацию, мы можем улучшить, изменить и даже переписать функцию с нуля, и при этом мы будем уверены, что она продолжает работать правильно.</p>
<p>Это особенно важно в больших проектах, когда одна функция может быть использована во множестве мест. Когда мы вносим в такую функцию изменения, у нас нет никакой возможности вручную проверить, что она продолжает работать правильно во всех местах, где её используют.</p>
<p>Не имея тестов, людям приходится выбирать один из двух путей:</p>
<ol>
<li>Внести изменения, и неважно, что будет. Потом у наших пользователей станут проявляться ошибки, ведь мы наверняка что-то забудем проверить вручную.</li>
<li>Или же, если наказание за ошибки в коде серьёзное, то люди просто побоятся вносить изменения в такие функции. Код будет стареть, «зарастать паутиной», и никто не захочет в него лезть. Это нехорошо для разработки.</li>
</ol>
<p><strong>Автоматическое тестирование кода позволяет избежать этих проблем!</strong></p>
<p>Если проект покрыт тестами, то вышеупомянутые проблемы не возникают. После любых изменений мы можем запустить тесты и увидеть результаты огромного количества проверок, сделанных за секунды.</p>
<p><strong>Кроме того, код, хорошо покрытый тестами, как правило, имеет лучшую архитектуру.</strong></p>
<p>Это естественно, ведь такой код легче менять и улучшать. Но не только по этой причине.</p>
<p>Для написания тестов нужно организовать код таким образом, чтобы у каждой функции была ясно поставленная задача и точно определены её аргументы и возвращаемое значение. А это означает, что мы получаем хорошую архитектуру с самого начала.</p>
<p>В реальности это не всегда так просто. Иногда сложно написать спецификацию до того, как будет написана реализация, потому что не всегда чётко понятно, как та или иная функция должна себя вести. Но в общем и целом написание тестов делает разработку быстрее, а итоговый продукт более стабильным.</p>
<p>Далее по книге мы встретим много задач с тестами, так что вы увидите много практических примеров.</p>
<p>Написание тестов требует хорошего знания JavaScript. Но мы только начали учить его. Не волнуйтесь. Пока вам не нужно писать тесты, но вы уже умеете их читать и поймёте даже более сложные примеры, чем те, что были представлены в этой главе.</p>
</div></article><div class="tasks formatted"><h2 class="tasks__title" id="tasks"><a class="tasks__title-anchor main__anchor main__anchor main__anchor_noicon" href="#tasks">Задачи</a></h2><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap"><h3 class="task__title"><a class="main__anchor" href="#chto-ne-tak-s-etim-testom" name="chto-ne-tak-s-etim-testom">Что не так с этим тестом?</a></h3><a class="task__open-link" href="task/pow-test-wrong.html" target="_blank"></a></div><div class="task__header-note"><span class="task__importance" title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 5</span></div><div class="task__content"><div class="task__formatted"><p>Что не так в нижеприведённом тесте функции <code>pow</code>?</p>
<div id="x1nzr3s909" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>it(&quot;Возводит x в степень n&quot;, function() {
  let x = 5;

  let result = x;
  assert.equal(pow(x, 1), result);

  result *= x;
  assert.equal(pow(x, 2), result);

  result *= x;
  assert.equal(pow(x, 3), result);
});</code></pre>
        </div>
      </div>
      
      </div><p>P.S. Тест не содержит синтаксических ошибок и успешно проходит.</p>
</div><button class="task__solution" type="button">решение</button><div class="task__answer"><div class="task__answer-content"><div class="formatted"><p>Тест демонстрирует один из соблазнов, с которым сталкиваются разработчики при их написании.</p>
<p>У нас тут, по сути, три теста, но они написаны как одна функция с тремя проверками.</p>
<p>Иногда так проще писать, но если произойдёт ошибка, то гораздо сложнее понять, что пошло не так.</p>
<p>Если ошибка происходит посередине сложного потока выполнения, то нам придётся выяснять, какие данные были в этом месте. По сути, придётся <em>отлаживать тест</em>.</p>
<p>Гораздо лучше разбить тест на несколько блоков <code>it</code> и ясно описать входные и ожидаемые на выходе данные.</p>
<p>Примерно так:</p>
<div id="sqpl390s9w" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>describe(&quot;Возводит x в степень n&quot;, function() {
  it(&quot;5 в степени 1 будет 5&quot;, function() {
    assert.equal(pow(5, 1), 5);
  });

  it(&quot;5 в степени 2 будет 25&quot;, function() {
    assert.equal(pow(5, 2), 25);
  });

  it(&quot;5 в степени 3 будет 125&quot;, function() {
    assert.equal(pow(5, 3), 125);
  });
});</code></pre>
        </div>
      </div>
      
      </div><p>Мы заменили один <code>it</code> на <code>describe</code> и группу блоков <code>it</code>. Теперь, если какой-либо из блоков завершится неудачно, мы точно увидим, с какими данными это произошло.</p>
<p>Также мы можем изолировать один тест и запускать только его, написав <code>it.only</code> вместо <code>it</code>:</p>
<div id="820o5iqekq" data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:5,&quot;end&quot;:8}]">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>describe(&quot;Возводит x в степень n&quot;, function() {
  it(&quot;5 в степени 1 будет 5&quot;, function() {
    assert.equal(pow(5, 1), 5);
  });

  // Mocha будет запускать только этот блок
  it.only(&quot;5 в степени 2 будет 25&quot;, function() {
    assert.equal(pow(5, 2), 25);
  });

  it(&quot;5 в степени 3 будет 125&quot;, function() {
    assert.equal(pow(5, 3), 125);
  });
});</code></pre>
        </div>
      </div>
      
      </div></div></div><button class="close-button task__answer-close" type="button" title="закрыть"></button></div></div></div></div></div></div><div class="page__nav-wrap"><a class="page__nav page__nav_prev" href="ninja-code.html" data-tooltip="Ниндзя-код"><span class="page__nav-text"><span class="page__nav-text-shortcut"></span></span><span class="page__nav-text-alternate">Предыдущий урок</span></a><a class="page__nav page__nav_next" href="polyfills.html" data-tooltip="Полифилы"><span class="page__nav-text"><span class="page__nav-text-shortcut"></span></span><span class="page__nav-text-alternate">Следующий урок</span></a></div><div class="article-tablet-foot tablet-only"><div class="article-tablet-foot__layout"><div class="share-icons"><span class="share-icons__title">Поделиться</span><a class="share share_tw" href="https://twitter.com/share?url=https%3A%2F%2Flearn.javascript.ru%2Ftesting-mocha" rel="nofollow"></a><a class="share share_fb" href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=https%3A%2F%2Flearn.javascript.ru%2Ftesting-mocha" rel="nofollow"></a><a class="share share_vk" href="https://vkontakte.ru/share.php?url=https%3A%2F%2Flearn.javascript.ru%2Ftesting-mocha" rel="nofollow"></a></div><div class="article-tablet-foot__map"><a class="map" href="tutorial/map.html" data-action="tutorial-map"><span class="map__text">Карта учебника</span></a></div></div></div><div class="banner-bottom"><div class="banner-bottom__text">Проводим <a href="courses.html">курсы по JavaScript и фреймворкам</a>.</div><button class="banner-bottom__close" data-banner-close="Courses" data-banner-close-message="Эта информация больше не будет выводиться." title="не показывать"></button></div><script>!!1&&"hideBannerCourses"in localStorage||(document.querySelector(".banner-bottom").style.display="flex");</script><div class="comments formatted" id="comments"><div class="comments__header"><h2 class="comments__header-title"><a href="#comments" name="comments">Комментарии</a></h2><div class="comments__read-before"><span class="comments__read-before-link">перед тем как писать…</span><div class="comments__read-before-popup"><div class="comments__read-before-popup-i"><ul><li>Если вам кажется, что в статье что-то не так - вместо комментария напишите <a href="https://github.com/javascript-tutorial/ru.javascript.info/issues/new">на GitHub</a>.</li><li>Для одной строки кода используйте тег <code>&lt;code&gt;</code>, для нескольких строк кода&nbsp;&mdash; тег <code>&lt;pre&gt;</code>, если больше 10 строк&nbsp;&mdash; ссылку на песочницу (<a href='https://plnkr.co/edit/?p=preview'>plnkr</a>, <a href='http://jsbin.com/'>JSBin</a>, <a href='http://codepen.io/'>codepen</a>…)</li><li>Если что-то непонятно в статье&nbsp;&mdash; пишите, что именно и с какого места.</li></ul></div></div></div></div><div id="disqus_thread"></div><script>var disqus_config = function() { if (!this.page) this.page = {}; Object.assign(this.page, {"url":"https:\/\/learn.javascript.ru\/testing-mocha","identifier":"\/testing-mocha"}); };</script><script>var disqus_shortname = "learnjavascriptru";</script><script>var disqus_enabled = true;</script></div></main></div><div class="sidebar page__sidebar sidebar sidebar_sticky-footer"><button class="sidebar__toggle" data-sidebar-toggle></button><a class="map" href="tutorial/map.html" data-action="tutorial-map" data-tooltip="Карта учебника"></a><div class="sidebar__inner"><div class="sidebar__content"><div class="sidebar__section"><h4 class="sidebar__section-title">Раздел</h4><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a class="sidebar__link" href="code-quality.html">Качество кода</a></li></ul></nav></div><div class="sidebar__section"><h4 class="sidebar__section-title">Навигация по уроку</h4><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a class="sidebar__link" href="#zachem-nam-nuzhny-testy">Зачем нам нужны тесты?</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#behavior-driven-development-bdd">Behavior Driven Development (BDD)</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#razrabotka-funktsii-vozvedeniya-v-stepen--pow-spetsifikatsiya">Разработка функции возведения в степень — «pow»: спецификация</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#protsess-razrabotki">Процесс разработки</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#spetsifikatsiya-v-deystvii">Спецификация в действии</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#nachalnaya-realizatsiya">Начальная реализация</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#uluchshaem-spetsifikatsiyu">Улучшаем спецификацию</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#uluchshaem-realizatsiyu">Улучшаем реализацию</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#vlozhennye-bloki-describe">Вложенные блоки describe</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#rasshirenie-spetsifikatsii">Расширение спецификации</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#itogo">Итого</a></li></ul></nav></div><div class="sidebar__section"><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a class="sidebar__link" href="#tasks">Задачи (1)</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#comments">Комментарии</a></li></ul></nav></div><div class="sidebar__section"><div class="sidebar__section-title">Поделиться</div><a class="share share_tw sidebar__share" href="https://twitter.com/share?url=https%3A%2F%2Flearn.javascript.ru%2Ftesting-mocha" rel="nofollow"></a><a class="share share_fb sidebar__share" href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p[url]=https%3A%2F%2Flearn.javascript.ru%2Ftesting-mocha" rel="nofollow"></a></div><div class="sidebar__section"><a class="sidebar__link" href="https://github.com/javascript-tutorial/ru.javascript.info/blob/master/1-js/03-code-quality/05-testing-mocha" rel="nofollow">Редактировать на GitHub</a></div></div></div></div></div></div><div class="page-footer"><ul class="page-footer__list"><li class="page-footer__item page-footer__item_copy">©&nbsp;2007—2023&nbsp; Илья Кантор</li><li class="page-footer__item page-footer__item_about"><a class="page-footer__link" href="about.html">о проекте</a></li><li class="page-footer__item page-footer__item_contact"><a class="page-footer__link" href="about.html#contact-us">связаться с нами</a></li><li class="page-footer__item page-footer__item_terms"><a class="page-footer__link" href="terms.html">пользовательское соглашение</a></li><li class="page-footer__item page-footer__item_privacy"><a class="page-footer__link" href="privacy.html">политика конфиденциальности</a></li></ul></div></body>
<!-- Mirrored from learn.javascript.ru/testing-mocha by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 01 Apr 2023 11:30:50 GMT -->
</html>