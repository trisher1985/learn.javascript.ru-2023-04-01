<!DOCTYPE html><html lang="ru" data-theme-enabled="1">
<!-- Mirrored from learn.javascript.ru/garbage-collection by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 01 Apr 2023 11:30:52 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><script>window.currentUser = null;</script><script>window.shopCurrency = "RUB";</script><script>window.localCurrency = "RUB";</script><script>window.countryCode = "us";</script><script>window.rateShopTo = {"RUB":1,"EUR":0.01190754245962824,"USD":0.012960082608603353,"AMD":5.0511763335620445};</script><title itemprop="name">Сборка мусора</title><link href="pack/styles.d76a6ae6433f1b0d6d11.css" rel="stylesheet"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes, minimum-scale=1.0"><meta name="apple-mobile-web-app-capable" content="yes"><!-- chrome autotranslate is enabled only for "en" main version--><meta name="google" content="notranslate"><script>if (window.devicePixelRatio > 1) document.cookie = 'pixelRatio=' + window.devicePixelRatio + ';path=/;expires=Tue, 19 Jan 2038 03:14:07 GMT';</script><link href="http://fonts.googleapis.com/css?family=Open+Sans:bold,italic,bolditalic" rel="stylesheet"><link rel="apple-touch-icon-precomposed" href="img/favicon/apple-touch-icon-precomposed.png"><link rel="canonical" href="garbage-collection.html"><meta name="msapplication-TileColor" content="#222A2C"><meta name="msapplication-TileImage" content="/img/favicon/tileicon.png"><link rel="icon" href="img/favicon/favicon.png"><meta itemprop="image" content="https://learn.javascript.ru/img/site_preview_ru_512x512.png"><meta property="og:title" content="Сборка мусора"><meta property="og:image" content="https://learn.javascript.ru/img/site_preview_ru_1200x630.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="fb:admins" content="100001562528165"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Сборка мусора"><meta name="twitter:site" content="@iliakan"><meta name="twitter:creator" content="@iliakan"><meta name="twitter:image" content="https://learn.javascript.ru/img/site_preview_ru_512x512.png"><link rel="prev" href="object-copy.html"><link rel="next" href="object-methods.html"><script>window.GA_ID = "UA-2056213-16";</script><script>window.GTM_ID = 'GTM-WD2DZPG'</script><script>window.YANDEX_METRIKA_ID = 17649010;</script><script>window.GoogleAnalyticsObject="ga",window.ga=function(){window.ga.q.push(arguments)},window.ga.q=[],window.ga.l=Date.now(),ga("create",GA_ID,"auto"),window.GTM_ID&&ga("require",GTM_ID),window.currentUser?ga("set","&uid",currentUser.id):ga("set","anonymizeIp",!0),window.addEventListener("error",function(e){var r=(e.filename||e.errorUrl)+": "+(e.lineno||e.errorLine),n=e.stack||e.error&&e.error.stack;ga("send","exception",{exDescription:e.message+" "+r+" "+n,exFatal:!0})});</script><script src="../www.google-analytics.com/analytics.js" async></script><script>ga('send', 'pageview');</script><script>window.metrika={reachGoal:function(){}},window.yandex_metrika_callbacks=[function(){try{window.metrika=new Ya.Metrika({id:YANDEX_METRIKA_ID,webvisor:!0,clickmap:!0,params:{user:window.currentUser&&window.currentUser.id}}),metrika.trackLinks({delay:150}),window.addEventListener("error",function(r){window.metrika.reachGoal("JSERROR",{src:(r.filename||r.errorUrl)+": "+(r.lineno||r.errorLine),stack:r.stack||r.error&&r.error.stack,message:r.message})})}catch(r){}}];</script><script src="../mc.yandex.ru/metrika/watch.js" async></script><script>window.RECAPTCHA_ID = "6LfmLAEVAAAAAJMykMnf7aY8nkyTRmYi2ynx51R1";</script><script src="pack/init.0a89b5228a4598490ad5.js"></script><script src="pack/head.ccd1a02912f51802640c.js" defer></script><meta property="og:title" content="Сборка мусора"><meta property="og:type" content="article"><script src="pack/tutorial.f78de0b8b0137f8052dd.js" defer></script><script src="pack/footer.0940b4b40eb12f87e263.js" defer></script></head><body class="no-icons"><script>window.fontTest();</script><div class="page-wrapper page-wrapper_sidebar_on"><!--[if IE]><div style="color:red;text-align:center">Извините, Internet Explorer не поддерживается, пожалуйста используйте более новый браузер.</div><![endif]--><div class="sitetoolbar sitetoolbar_tutorial"><script>window.langs = [{"code":"ar","name":"Arabic"},{"code":"az","name":"Azerbaijani"},{"code":"bg","name":"Bulgarian"},{"code":"bn","name":"Bengali"},{"code":"bs","name":"Bosnian"},{"code":"ca","name":"Catalan"},{"code":"cs","name":"Czech"},{"code":"da","name":"Danish"},{"code":"de","name":"German"},{"code":"el","name":"Greek"},{"code":"en","name":"English"},{"code":"es","name":"Spanish"},{"code":"fa","name":"Persian (Farsi)"},{"code":"fi","name":"Finnish"},{"code":"fr","name":"French"},{"code":"he","name":"Hebrew"},{"code":"hi","name":"Hindi"},{"code":"hr","name":"Croatian"},{"code":"hu","name":"Hungarian"},{"code":"hy","name":"Armenian"},{"code":"id","name":"Indonesian"},{"code":"it","name":"Italian"},{"code":"ja","name":"Japanese"},{"code":"ka","name":"Georgian"},{"code":"kk","name":"Kazakh"},{"code":"km","name":"Central Khmer"},{"code":"ko","name":"Korean"},{"code":"ky","name":"Kyrgyz"},{"code":"lt","name":"Lithuanian"},{"code":"me","name":"Montenegrin"},{"code":"ml","name":"Malayalam"},{"code":"ms","name":"Malay"},{"code":"my","name":"Burmese"},{"code":"nl","name":"Dutch"},{"code":"no","name":"Norvegian"},{"code":"pa","name":"Punjabi"},{"code":"pl","name":"Polish"},{"code":"pt","name":"Portuguese"},{"code":"ro","name":"Romanian"},{"code":"ru","name":"Russian"},{"code":"si","name":"Sinhala"},{"code":"sk","name":"Slovak"},{"code":"sl","name":"Slovenian"},{"code":"sq","name":"Albanian"},{"code":"sr","name":"Serbian"},{"code":"ta","name":"Tamil"},{"code":"te","name":"Telugu"},{"code":"test","name":"Test"},{"code":"th","name":"Thai"},{"code":"tk","name":"Turkmen"},{"code":"tr","name":"Turkish"},{"code":"ug","name":"Uyghur"},{"code":"uk","name":"Ukrainian"},{"code":"ur","name":"Urdu"},{"code":"uz","name":"Uzbek"},{"code":"v2","name":"v2"},{"code":"vi","name":"Vietnamese"},{"code":"zh-hant","name":"Chinese Traditional"},{"code":"zh","name":"Chinese"}];</script><script>window.lang = "ru";</script><script>{let t=navigator.languages||[];t=t.map(t=>t.toLowerCase());let o,i,n=[];for(let o of window.langs)for(let i of t)if(i===o.code||i.startsWith(o.code+"-")){n.push(o);break}if(!o&&"ru"!=lang&&"en"!=lang){n.find(t=>"en"==t.code)&&(o=`\n            According to your browser headers, you know English. Please help to <a href="https://github.com/javascript-tutorial/${lang}.javascript.info#readme">translate the tutorial</a>.\n            Thank you!\n          `,i="notify-translate-tutorial-local")}if(o){let t=`<div class="notification notification_top notification_info sitetoolbar__notification" style="display:none" id="${i}">\n          <div class="notification__content">${o}</div>\n          <button class="notification__close" title="Close"></button>\n        </div>`;document.write(t),showTopNotification()}}</script><div class="sitetoolbar__content"><div class="sitetoolbar__lang-switcher"><button class="sitetoolbar__dropdown-button" data-dropdown-toggler>RU</button><div class="sitetoolbar__dropdown-wrap"><div class="sitetoolbar__dropdown-body"><div class="sitetoolbar__lang-switcher-body"><div class="supported-langs supported-langs_toolbar"><div class="supported-langs__container"><ul class="supported-langs__list" style="height:200px"><li class="supported-langs__item"><a class="supported-langs__link" href="https://ar.javascript.info/garbage-collection"><span class="supported-langs__brief">AR</span><span class="supported-langs__title">عربي</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://javascript.info/garbage-collection"><span class="supported-langs__brief">EN</span><span class="supported-langs__title">English</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://es.javascript.info/garbage-collection"><span class="supported-langs__brief">ES</span><span class="supported-langs__title">Español</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://fa.javascript.info/garbage-collection"><span class="supported-langs__brief">FA</span><span class="supported-langs__title">فارسی</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://fr.javascript.info/garbage-collection"><span class="supported-langs__brief">FR</span><span class="supported-langs__title">Français</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://id.javascript.info/garbage-collection"><span class="supported-langs__brief">ID</span><span class="supported-langs__title">Indonesia</span></a></li></ul><ul class="supported-langs__list" style="height:200px"><li class="supported-langs__item"><a class="supported-langs__link" href="https://it.javascript.info/garbage-collection"><span class="supported-langs__brief">IT</span><span class="supported-langs__title">Italiano</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://ja.javascript.info/garbage-collection"><span class="supported-langs__brief">JA</span><span class="supported-langs__title">日本語</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://ko.javascript.info/garbage-collection"><span class="supported-langs__brief">KO</span><span class="supported-langs__title">한국어</span></a></li><li class="supported-langs__item supported-langs__item_current"><a class="supported-langs__link" href="garbage-collection.html"><span class="supported-langs__brief">RU</span><span class="supported-langs__title">Русский</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://tr.javascript.info/garbage-collection"><span class="supported-langs__brief">TR</span><span class="supported-langs__title">Türkçe</span></a></li><li class="supported-langs__item"><a class="supported-langs__link" href="https://uk.javascript.info/garbage-collection"><span class="supported-langs__brief">UK</span><span class="supported-langs__title">Українська</span></a></li></ul><ul class="supported-langs__list" style="height:20px"><li class="supported-langs__item"><a class="supported-langs__link" href="https://zh.javascript.info/garbage-collection"><span class="supported-langs__brief">ZH</span><span class="supported-langs__title">简体中文</span></a></li></ul></div><div class="supported-langs__text">Мы хотим сделать этот проект с открытым исходным кодом доступным для людей во всем мире. Пожалуйста, <a href="https://javascript.info/translate#help" rel="noopener noreferrer" target="_blank">помогите нам перевести</a> это руководство на свой язык</div></div></div></div></div></div><div class="sitetoolbar__logo-wrap"><a class="sitetoolbar__link sitetoolbar__link_logo" href="index.html"><img class="sitetoolbar__logo sitetoolbar__logo_normal" src="img/sitetoolbar__logo_ru.svg" width="171" alt="" role="presentation"/><img class="sitetoolbar__logo sitetoolbar__logo_normal sitetoolbar__logo_dark" src="img/sitetoolbar__logo_ru-white.svg" width="171" alt="" role="presentation"/><img class="sitetoolbar__logo sitetoolbar__logo_small" src="img/sitetoolbar__logo_small_ru.svg" width="80" alt="" role="presentation"/><img class="sitetoolbar__logo sitetoolbar__logo_small sitetoolbar__logo_dark" src="img/sitetoolbar__logo_small_ru-white.svg" width="80" alt="" role="presentation"/><script>Array.prototype.forEach.call(document.querySelectorAll("img.sitetoolbar__logo"),function(e){let t=document.createElement("object");t.type="image/svg+xml",t.className=e.className,t.style.cssText="left:0;top:0;position:absolute",t.onload=function(){t.onload=null,e.style.visibility="hidden"},t.data=e.src,e.parentNode.insertBefore(t,e)});</script></a></div><div class="sitetoolbar__nav-toggle-wrap"><button class="sitetoolbar__nav-toggle" type="button"></button></div><nav class="sitetoolbar__sections"><ul class="sitetoolbar__sections-list"><li class="sitetoolbar__section sitetoolbar__section_current"><a class="sitetoolbar__link" href="index.html">Учебник</a></li><li class="sitetoolbar__section"><a class="sitetoolbar__link" href="courses.html">Курсы</a></li><li class="sitetoolbar__section"><a class="sitetoolbar__link" href="https://javascript.ru/forum/">Форум</a></li><li class="sitetoolbar__section"><a class="sitetoolbar__link" href="quiz.html">Тесты знаний</a></li><li class="sitetoolbar__section sitetoolbar__section_dropdown"><button class="sitetoolbar__dropdown-button" data-dropdown-toggler>Скринкасты</button><div class="sitetoolbar__dropdown-wrap"><div class="sitetoolbar__dropdown-body"><ul class="sitetoolbar__dropdown-items"><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="screencast/nodejs.html">Node.js</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="screencast/webpack.html">Webpack</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="screencast/gulp.html">Gulp</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="screencast/react.html">React.js</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="screencast/angular.html">Angular</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="https://youtu.be/W4hoc24K93E?list=PLDyvV36pndZFHXjXuwA_NywNrVQO0aQqb">Git: курс</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="https://youtu.be/lHacJuru1bc?list=PLDyvV36pndZEB7kWWocU4QSn-G78LoaEE">Git: разное</a></li></ul></div></div></li></ul></nav><div class="sitetoolbar__right-button-wrap"><a class="sitetoolbar-right-button sitetoolbar-right-button_courses" href="ebook.html"><span class="sitetoolbar-right-button__extra-text">Купить</span><span class="sitetoolbar-right-button__text">EPUB/PDF</span></a></div><div class="sitetoolbar__login-wrap"><button class="sitetoolbar__login sitetoolbar__login_unready" data-action-login></button></div><div class="sitetoolbar__theme-switcher"><div class="theme-changer"><label class="theme-changer__label" for="theme-changer-input" data-tooltip="Сменить тему оформления"><input class="theme-changer__input" type="checkbox" id="theme-changer-input" data-theme-changer="data-theme-changer"/><span class="theme-changer__icon theme-changer__icon_light-theme"></span><span class="theme-changer__icon theme-changer__icon_dark-theme"></span></label></div></div><div class="sitetoolbar__search-wrap"><div class="sitetoolbar__search-content"><button class="sitetoolbar__search-toggle" type="button"></button><form class="sitetoolbar__search" method="GET" action="https://learn.javascript.ru/search"><div class="sitetoolbar__search-input"><div class="text-input"><input class="text-input__control" name="query" placeholder="Искать на Javascript.ru" required="required" type="text"/></div><button class="sitetoolbar__find" type="submit">Найти</button></div></form></div></div></div><div class="tablet-menu"><div class="tablet-menu__line"><div class="tablet-menu__content"><select class="tablet-menu__nav input-select input-select input-select_small" onchange="if(this.value) window.location.href=this.value"><option value="/" selected>Учебник</option><option value="/courses">Курсы</option><option value="https://javascript.ru/forum/">Форум</option><option value="/quiz">Тесты знаний</option></select></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><form class="tablet-menu-search" action="https://learn.javascript.ru/search/"><input class="tablet-menu-search__input" type="search" name="query" placeholder="Поиск в учебнике" required="required"/><button class="tablet-menu-search__button" type="submit" name="type" value="articles">Поиск</button></form></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><a class="map" href="tutorial/map.html" data-action="tutorial-map"><span class="map__text">Карта учебника</span></a></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><div class="theme-changer theme-changer_tablet-menu theme-changer_has-label"><label class="theme-changer__label" for="theme-changer-input-tablet" data-tooltip="Сменить тему оформления"><input class="theme-changer__input" type="checkbox" id="theme-changer-input-tablet" data-theme-changer="data-theme-changer"/><span class="theme-changer__icon theme-changer__icon_light-theme"></span><span class="theme-changer__icon theme-changer__icon_dark-theme"></span><span class="theme-changer__label-text theme-changer__label-text_light-theme">Светлая тема</span><span class="theme-changer__label-text theme-changer__label-text_dark-theme">Тёмная тема</span></label></div></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><div class="share-icons"><span class="share-icons__title">Поделиться</span><a class="share share_tw" href="https://twitter.com/share?url=https%3A%2F%2Flearn.javascript.ru%2Fgarbage-collection" rel="nofollow"></a><a class="share share_fb" href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=https%3A%2F%2Flearn.javascript.ru%2Fgarbage-collection" rel="nofollow"></a><a class="share share_vk" href="https://vkontakte.ru/share.php?url=https%3A%2F%2Flearn.javascript.ru%2Fgarbage-collection" rel="nofollow"></a></div></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><select class="tablet-menu__nav input-select input-select input-select_small" onchange="if(this.value) window.location.href=this.value"><option value="https://ar.javascript.info/garbage-collection">عربي</option><option value="https://javascript.info/garbage-collection">English</option><option value="https://es.javascript.info/garbage-collection">Español</option><option value="https://fa.javascript.info/garbage-collection">فارسی</option><option value="https://fr.javascript.info/garbage-collection">Français</option><option value="https://id.javascript.info/garbage-collection">Indonesia</option><option value="https://it.javascript.info/garbage-collection">Italiano</option><option value="https://ja.javascript.info/garbage-collection">日本語</option><option value="https://ko.javascript.info/garbage-collection">한국어</option><option value="https://learn.javascript.ru/garbage-collection" selected>Русский</option><option value="https://tr.javascript.info/garbage-collection">Türkçe</option><option value="https://uk.javascript.info/garbage-collection">Українська</option><option value="https://zh.javascript.info/garbage-collection">简体中文</option></select></div></div></div><progress class="tutorial-progress" data-sticky value="31" max="95" data-tooltip="Урок 31 из 95"></progress></div><div class="page page_sidebar_on page_inner_padding"><script>if(localStorage.noSidebar){document.querySelector(".page").classList.remove("page_sidebar_on");let e=document.querySelector(".page-wrapper");e&&e.classList.remove("page-wrapper_sidebar_on")}setTimeout(function(){document.querySelector(".page").classList.add("page_sidebar-animation-on")});</script><div class="page__inner"><main class="main main_width-limit"><header class="main__header"><div class="main__header-inner"><div class="main__header-group"><ol class="breadcrumbs"><li class="breadcrumbs__item breadcrumbs__item_home"><a class="breadcrumbs__link" href="index.html"><span class="breadcrumbs__hidden-text">Учебник</span></a></li><li class="breadcrumbs__item" id="breadcrumb-1"><a class="breadcrumbs__link" href="js.html"><span>Язык JavaScript</span></a></li><li class="breadcrumbs__item" id="breadcrumb-2"><a class="breadcrumbs__link" href="object-basics.html"><span>Объекты: основы</span></a></li><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Учебник","item":"https://learn.javascript.ru/"},{"@type":"ListItem","position":2,"name":"Язык JavaScript","item":"https://learn.javascript.ru/js"},{"@type":"ListItem","position":3,"name":"Объекты: основы","item":"https://learn.javascript.ru/object-basics"}]}</script></ol><div class="updated-at" data-tooltip="Последнее обновление: 7 июня 2022 г."><div class="updated-at__content">7 июня 2022 г.</div></div></div><h1 class="main__header-title">Сборка мусора</h1></div></header><div class="content"><article class="formatted" itemscope itemtype="http://schema.org/TechArticle"><meta itemprop="name" content="Сборка мусора"><div itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="email" content="iliakan@gmail.com"><meta itemprop="name" content="Ilya Kantor"></div><div itemprop="articleBody"><p>Управление памятью в JavaScript выполняется автоматически и незаметно. Мы создаём примитивы, объекты, функции… Всё это занимает память.</p>
<p>Но что происходит, когда что-то больше не нужно? Как движок JavaScript обнаруживает, что пора очищать память?</p>
<h2><a class="main__anchor" name="dostizhimost" href="#dostizhimost">Достижимость</a></h2><p>Основной концепцией управления памятью в JavaScript является принцип <em>достижимости</em>.</p>
<p>Если упростить, то «достижимые» значения – это те, которые доступны или используются. Они гарантированно находятся в памяти.</p>
<ol>
<li>
<p>Существует базовое множество достижимых значений, которые не могут быть удалены.</p>
<p>Например:</p>
<ul>
<li>Выполняемая в данный момент функция, её локальные переменные и параметры.</li>
<li>Другие функции в текущей цепочке вложенных вызовов, их локальные переменные и параметры.</li>
<li>Глобальные переменные.</li>
<li>(некоторые другие внутренние значения)</li>
</ul>
<p>Эти значения мы будем называть <em>корнями</em>.</p>
</li>
<li>
<p>Любое другое значение считается достижимым, если оно доступно из корня по ссылке или по цепочке ссылок.</p>
<p>Например, если в глобальной переменной есть объект, и он имеет свойство, в котором хранится ссылка на другой объект, то <em>этот</em> объект считается достижимым. И те, на которые он ссылается, тоже достижимы. Далее вы познакомитесь с подробными примерами на эту тему.</p>
</li>
</ol>
<p>В движке JavaScript есть фоновый процесс, который называется <a href="https://ru.wikipedia.org/wiki/Сборка_мусора">сборщиком мусора</a>. Он отслеживает все объекты и удаляет те, которые стали недоступными.</p>
<h2><a class="main__anchor" name="prostoy-primer" href="#prostoy-primer">Простой пример</a></h2><p>Вот самый простой пример:</p>
<div id="dtzmf3iigv" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>// в user находится ссылка на объект
let user = {
  name: &quot;John&quot;
};</code></pre>
        </div>
      </div>
      
      </div><figure><div class="image" style="width:144px">
      <div class="image__ratio" style="padding-top:104.16666666666667%"></div>
      <object type="image/svg+xml" data="article/garbage-collection/memory-user-john.svg" width="144" height="150" class="image__image" data-use-theme>
        <img src="article/garbage-collection/memory-user-john.svg" alt="" width="144" height="150">
      </object>
      </div></figure><p>Здесь стрелка обозначает ссылку на объект. Глобальная переменная <code>user</code> ссылается на объект <code>{name: &quot;John&quot;}</code> (мы будем называть его просто «John» для краткости). В свойстве <code>&quot;name&quot;</code> объекта John хранится примитив, поэтому оно нарисовано внутри объекта.</p>
<p>Если перезаписать значение <code>user</code>, то ссылка потеряется:</p>
<div id="ve4ky26q7h" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>user = null;</code></pre>
        </div>
      </div>
      
      </div><figure><div class="image" style="width:225px">
      <div class="image__ratio" style="padding-top:70.66666666666667%"></div>
      <object type="image/svg+xml" data="article/garbage-collection/memory-user-john-lost.svg" width="225" height="159" class="image__image" data-use-theme>
        <img src="article/garbage-collection/memory-user-john-lost.svg" alt="" width="225" height="159">
      </object>
      </div></figure><p>Теперь объект John становится недостижимым. К нему нет доступа, на него нет ссылок. Сборщик мусора удалит эти данные и освободит память.</p>
<h2><a class="main__anchor" name="dve-ssylki" href="#dve-ssylki">Две ссылки</a></h2><p>Представим, что мы скопировали ссылку из <code>user</code> в <code>admin</code>:</p>
<div id="22adj2gc0u" data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:5,&quot;end&quot;:5}]">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>// в user находится ссылка на объект
let user = {
  name: &quot;John&quot;
};

let admin = user;</code></pre>
        </div>
      </div>
      
      </div><figure><div class="image" style="width:144px">
      <div class="image__ratio" style="padding-top:110.41666666666667%"></div>
      <object type="image/svg+xml" data="article/garbage-collection/memory-user-john-admin.svg" width="144" height="159" class="image__image" data-use-theme>
        <img src="article/garbage-collection/memory-user-john-admin.svg" alt="" width="144" height="159">
      </object>
      </div></figure><p>Теперь, если мы сделаем то же самое:</p>
<div id="8pdgg9yf1h" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>user = null;</code></pre>
        </div>
      </div>
      
      </div><p>…то объект John всё ещё достижим через глобальную переменную <code>admin</code>, поэтому он находится в памяти. Если бы мы также перезаписали <code>admin</code>, то John был бы удалён.</p>
<h2><a class="main__anchor" name="vzaimosvyazannye-obekty" href="#vzaimosvyazannye-obekty">Взаимосвязанные объекты</a></h2><p>Теперь более сложный пример. Семья:</p>
<div id="u0yf8t4uxw" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>function marry(man, woman) {
  woman.husband = man;
  man.wife = woman;

  return {
    father: man,
    mother: woman
  }
}

let family = marry({
  name: &quot;John&quot;
}, {
  name: &quot;Ann&quot;
});</code></pre>
        </div>
      </div>
      
      </div><p>Функция <code>marry</code> «женит» два объекта, давая им ссылки друг на друга, и возвращает новый объект, содержащий ссылки на два предыдущих.</p>
<p>В результате получаем такую структуру памяти:</p>
<figure><div class="image" style="width:337px">
      <div class="image__ratio" style="padding-top:60.534124629080125%"></div>
      <object type="image/svg+xml" data="article/garbage-collection/family.svg" width="337" height="204" class="image__image" data-use-theme>
        <img src="article/garbage-collection/family.svg" alt="" width="337" height="204">
      </object>
      </div></figure><p>На данный момент все объекты достижимы.</p>
<p>Теперь удалим две ссылки:</p>
<div id="gqtsht4nsi" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>delete family.father;
delete family.mother.husband;</code></pre>
        </div>
      </div>
      
      </div><figure><div class="image" style="width:337px">
      <div class="image__ratio" style="padding-top:60.534124629080125%"></div>
      <object type="image/svg+xml" data="article/garbage-collection/family-delete-refs.svg" width="337" height="204" class="image__image" data-use-theme>
        <img src="article/garbage-collection/family-delete-refs.svg" alt="" width="337" height="204">
      </object>
      </div></figure><p>Недостаточно удалить только одну из этих двух ссылок, потому что все объекты останутся достижимыми.</p>
<p>Но если мы удалим обе, то увидим, что у объекта John больше нет входящих ссылок:</p>
<figure><div class="image" style="width:399px">
      <div class="image__ratio" style="padding-top:56.390977443609025%"></div>
      <object type="image/svg+xml" data="article/garbage-collection/family-no-father.svg" width="399" height="225" class="image__image" data-use-theme>
        <img src="article/garbage-collection/family-no-father.svg" alt="" width="399" height="225">
      </object>
      </div></figure><p>Исходящие ссылки не имеют значения. Только входящие ссылки могут сделать объект достижимым. Объект John теперь недостижим и будет удалён из памяти со всеми своими данными, которые также стали недоступны.</p>
<p>После сборки мусора:</p>
<figure><div class="image" style="width:144px">
      <div class="image__ratio" style="padding-top:156.25%"></div>
      <object type="image/svg+xml" data="article/garbage-collection/family-no-father-2.svg" width="144" height="225" class="image__image" data-use-theme>
        <img src="article/garbage-collection/family-no-father-2.svg" alt="" width="144" height="225">
      </object>
      </div></figure><h2><a class="main__anchor" name="nedostizhimyy-ostrov" href="#nedostizhimyy-ostrov">Недостижимый «остров»</a></h2><p>Вполне возможна ситуация, при которой целый «остров» взаимосвязанных объектов может стать недостижимым и удалиться из памяти.</p>
<p>Возьмём объект <code>family</code> из примера выше. А затем:</p>
<div id="o3ocpqsiso" data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code>family = null;</code></pre>
        </div>
      </div>
      
      </div><p>Структура в памяти теперь станет такой:</p>
<figure><div class="image" style="width:420px">
      <div class="image__ratio" style="padding-top:66.42857142857143%"></div>
      <object type="image/svg+xml" data="article/garbage-collection/family-no-family.svg" width="420" height="279" class="image__image" data-use-theme>
        <img src="article/garbage-collection/family-no-family.svg" alt="" width="420" height="279">
      </object>
      </div></figure><p>Этот пример демонстрирует, насколько важна концепция достижимости.</p>
<p>Объекты John и Ann всё ещё связаны, оба имеют входящие ссылки, но этого недостаточно.</p>
<p>Бывший объект <code>family</code> был отсоединён от корня, на него больше нет ссылки, поэтому весь «остров» становится недостижимым и будет удалён.</p>
<h2><a class="main__anchor" name="vnutrennie-algoritmy" href="#vnutrennie-algoritmy">Внутренние алгоритмы</a></h2><p>Основной алгоритм сборки мусора называется «алгоритм пометок» (от англ. «mark-and-sweep»).</p>
<p>Согласно этому алгоритму, сборщик мусора регулярно выполняет следующие шаги:</p>
<ul>
<li>Сборщик мусора «помечает» (запоминает) все корневые объекты.</li>
<li>Затем он идёт по ним и «помечает» все ссылки из них.</li>
<li>Затем он идёт по отмеченным объектам и отмечает их ссылки. Все посещённые объекты запоминаются, чтобы в будущем не посещать один и тот же объект дважды.</li>
<li>…И так далее, пока не будут посещены все достижимые (из корней) ссылки.</li>
<li>Все непомеченные объекты удаляются.</li>
</ul>
<p>Например, пусть наша структура объектов выглядит так:</p>
<figure><div class="image" style="width:463px">
      <div class="image__ratio" style="padding-top:44.06047516198704%"></div>
      <object type="image/svg+xml" data="article/garbage-collection/garbage-collection-1.svg" width="463" height="204" class="image__image" data-use-theme>
        <img src="article/garbage-collection/garbage-collection-1.svg" alt="" width="463" height="204">
      </object>
      </div></figure><p>Мы ясно видим «недостижимый остров» справа. Теперь давайте посмотрим, как будет работать «алгоритм пометок» сборщика мусора.</p>
<p>На первом шаге помечаются корни:</p>
<figure><div class="image" style="width:463px">
      <div class="image__ratio" style="padding-top:44.06047516198704%"></div>
      <object type="image/svg+xml" data="article/garbage-collection/garbage-collection-2.svg" width="463" height="204" class="image__image" data-use-theme>
        <img src="article/garbage-collection/garbage-collection-2.svg" alt="" width="463" height="204">
      </object>
      </div></figure><p>Затем помечаются объекты по их ссылкам:</p>
<figure><div class="image" style="width:463px">
      <div class="image__ratio" style="padding-top:44.06047516198704%"></div>
      <object type="image/svg+xml" data="article/garbage-collection/garbage-collection-3.svg" width="463" height="204" class="image__image" data-use-theme>
        <img src="article/garbage-collection/garbage-collection-3.svg" alt="" width="463" height="204">
      </object>
      </div></figure><p>…А затем объекты по их ссылкам и так далее, пока это возможно:</p>
<figure><div class="image" style="width:463px">
      <div class="image__ratio" style="padding-top:44.06047516198704%"></div>
      <object type="image/svg+xml" data="article/garbage-collection/garbage-collection-4.svg" width="463" height="204" class="image__image" data-use-theme>
        <img src="article/garbage-collection/garbage-collection-4.svg" alt="" width="463" height="204">
      </object>
      </div></figure><p>Теперь объекты, которые не удалось посетить в процессе, считаются недостижимыми и будут удалены:</p>
<figure><div class="image" style="width:463px">
      <div class="image__ratio" style="padding-top:44.06047516198704%"></div>
      <object type="image/svg+xml" data="article/garbage-collection/garbage-collection-5.svg" width="463" height="204" class="image__image" data-use-theme>
        <img src="article/garbage-collection/garbage-collection-5.svg" alt="" width="463" height="204">
      </object>
      </div></figure><p>Мы также можем представить себе этот процесс как выливание огромного ведра краски из корней, которая течёт по всем ссылкам и отмечает все достижимые объекты. Затем непомеченные удаляются.</p>
<p>Это концепция того, как работает сборка мусора. Движки JavaScript применяют множество оптимизаций, чтобы она работала быстрее и не задерживала выполнение кода.</p>
<p>Вот некоторые из оптимизаций:</p>
<ul>
<li><strong>Сборка по поколениям (Generational collection)</strong> – объекты делятся на два набора: «новые» и «старые». В типичном коде многие объекты имеют короткую жизнь: они появляются, выполняют свою работу и быстро умирают, так что имеет смысл отслеживать новые объекты и, если это так, быстро очищать от них память. Те, которые выживают достаточно долго, становятся «старыми» и проверяются реже.</li>
<li><strong>Инкрементальная сборка (Incremental collection)</strong> – если объектов много, и мы пытаемся обойти и пометить весь набор объектов сразу, это может занять некоторое время и привести к видимым задержкам в выполнения скрипта. Так что движок делит всё множество объектов на части, и далее очищает их одну за другой. Получается несколько небольших сборок мусора вместо одной всеобщей. Это требует дополнительного учёта для отслеживания изменений между частями, но зато получается много крошечных задержек вместо одной большой.</li>
<li><strong>Сборка в свободное время (Idle-time collection)</strong> – чтобы уменьшить возможное влияние на производительность, сборщик мусора старается работать только во время простоя процессора.</li>
</ul>
<p>Существуют и другие способы оптимизации и разновидности алгоритмов сборки мусора. Но как бы мне ни хотелось описать их здесь, я должен воздержаться, потому что разные движки реализуют разные хитрости и методы. И, что ещё более важно, все меняется по мере развития движков, поэтому изучать тему глубоко «заранее», без реальной необходимости, вероятно, не стоит. Если, конечно, это не вопрос чистого интереса, тогда для вас будет несколько ссылок ниже.</p>
<h2><a class="main__anchor" name="itogo" href="#itogo">Итого</a></h2><p>Главное, что нужно знать:</p>
<ul>
<li>Сборка мусора выполняется автоматически. Мы не можем ускорить или предотвратить её.</li>
<li>Объекты сохраняются в памяти, пока они достижимы.</li>
<li>Если на объект есть ссылка – вовсе не факт, что он является достижимым (из корня): набор взаимосвязанных объектов может стать недоступен в целом, как мы видели в примере выше.</li>
</ul>
<p>Современные движки реализуют разные продвинутые алгоритмы сборки мусора.</p>
<p>О многих из них рассказано в прекрасной книге о сборке мусора «The Garbage Collection Handbook: The Art of Automatic Memory Management» (R. Jones и др.).</p>
<p>Если вы знакомы с низкоуровневым программированием, то более подробная информация о сборщике мусора V8 находится в статье <a href="https://jayconrod.com/posts/55/a-tour-of-v8-garbage-collection">A tour of V8: Garbage Collection</a>.</p>
<p>Также в <a href="https://v8.dev/">блоге V8</a> время от времени публикуются статьи об изменениях в управлении памятью. Разумеется, чтобы изучить сборку мусора, вам лучше подготовиться, узнав о том как устроен движок V8 внутри в целом и почитав блог <a href="https://mrale.ph/">Вячеслава Егорова</a>, одного из инженеров, разрабатывавших V8. Я говорю про «V8», потому что он лучше всего освещается в статьях в Интернете. Для других движков многие подходы схожи, но сборка мусора отличается во многих аспектах.</p>
<p>Глубокое понимание работы движков полезно, когда вам нужна низкоуровневая оптимизация. Было бы разумно запланировать их изучение как следующий шаг после того, как вы познакомитесь с языком.</p>
</div></article></div><div class="page__nav-wrap"><a class="page__nav page__nav_prev" href="object-copy.html" data-tooltip="Копирование объектов и ссылки"><span class="page__nav-text"><span class="page__nav-text-shortcut"></span></span><span class="page__nav-text-alternate">Предыдущий урок</span></a><a class="page__nav page__nav_next" href="object-methods.html" data-tooltip="Методы объекта, &quot;this&quot;"><span class="page__nav-text"><span class="page__nav-text-shortcut"></span></span><span class="page__nav-text-alternate">Следующий урок</span></a></div><div class="article-tablet-foot tablet-only"><div class="article-tablet-foot__layout"><div class="share-icons"><span class="share-icons__title">Поделиться</span><a class="share share_tw" href="https://twitter.com/share?url=https%3A%2F%2Flearn.javascript.ru%2Fgarbage-collection" rel="nofollow"></a><a class="share share_fb" href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=https%3A%2F%2Flearn.javascript.ru%2Fgarbage-collection" rel="nofollow"></a><a class="share share_vk" href="https://vkontakte.ru/share.php?url=https%3A%2F%2Flearn.javascript.ru%2Fgarbage-collection" rel="nofollow"></a></div><div class="article-tablet-foot__map"><a class="map" href="tutorial/map.html" data-action="tutorial-map"><span class="map__text">Карта учебника</span></a></div></div></div><div class="banner-bottom"><div class="banner-bottom__text">Проводим <a href="courses.html">курсы по JavaScript и фреймворкам</a>.</div><button class="banner-bottom__close" data-banner-close="Courses" data-banner-close-message="Эта информация больше не будет выводиться." title="не показывать"></button></div><script>!!1&&"hideBannerCourses"in localStorage||(document.querySelector(".banner-bottom").style.display="flex");</script><div class="comments formatted" id="comments"><div class="comments__header"><h2 class="comments__header-title"><a href="#comments" name="comments">Комментарии</a></h2><div class="comments__read-before"><span class="comments__read-before-link">перед тем как писать…</span><div class="comments__read-before-popup"><div class="comments__read-before-popup-i"><ul><li>Если вам кажется, что в статье что-то не так - вместо комментария напишите <a href="https://github.com/javascript-tutorial/ru.javascript.info/issues/new">на GitHub</a>.</li><li>Для одной строки кода используйте тег <code>&lt;code&gt;</code>, для нескольких строк кода&nbsp;&mdash; тег <code>&lt;pre&gt;</code>, если больше 10 строк&nbsp;&mdash; ссылку на песочницу (<a href='https://plnkr.co/edit/?p=preview'>plnkr</a>, <a href='http://jsbin.com/'>JSBin</a>, <a href='http://codepen.io/'>codepen</a>…)</li><li>Если что-то непонятно в статье&nbsp;&mdash; пишите, что именно и с какого места.</li></ul></div></div></div></div><div id="disqus_thread"></div><script>var disqus_config = function() { if (!this.page) this.page = {}; Object.assign(this.page, {"url":"https:\/\/learn.javascript.ru\/garbage-collection","identifier":"\/garbage-collection"}); };</script><script>var disqus_shortname = "learnjavascriptru";</script><script>var disqus_enabled = true;</script></div></main></div><div class="sidebar page__sidebar sidebar sidebar_sticky-footer"><button class="sidebar__toggle" data-sidebar-toggle></button><a class="map" href="tutorial/map.html" data-action="tutorial-map" data-tooltip="Карта учебника"></a><div class="sidebar__inner"><div class="sidebar__content"><div class="sidebar__section"><h4 class="sidebar__section-title">Раздел</h4><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a class="sidebar__link" href="object-basics.html">Объекты: основы</a></li></ul></nav></div><div class="sidebar__section"><h4 class="sidebar__section-title">Навигация по уроку</h4><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a class="sidebar__link" href="#dostizhimost">Достижимость</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#prostoy-primer">Простой пример</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#dve-ssylki">Две ссылки</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#vzaimosvyazannye-obekty">Взаимосвязанные объекты</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#nedostizhimyy-ostrov">Недостижимый «остров»</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#vnutrennie-algoritmy">Внутренние алгоритмы</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="#itogo">Итого</a></li></ul></nav></div><div class="sidebar__section"><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a class="sidebar__link" href="#comments">Комментарии</a></li></ul></nav></div><div class="sidebar__section"><div class="sidebar__section-title">Поделиться</div><a class="share share_tw sidebar__share" href="https://twitter.com/share?url=https%3A%2F%2Flearn.javascript.ru%2Fgarbage-collection" rel="nofollow"></a><a class="share share_fb sidebar__share" href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p[url]=https%3A%2F%2Flearn.javascript.ru%2Fgarbage-collection" rel="nofollow"></a></div><div class="sidebar__section"><a class="sidebar__link" href="https://github.com/javascript-tutorial/ru.javascript.info/blob/master/1-js/04-object-basics/03-garbage-collection" rel="nofollow">Редактировать на GitHub</a></div></div></div></div></div></div><div class="page-footer"><ul class="page-footer__list"><li class="page-footer__item page-footer__item_copy">©&nbsp;2007—2023&nbsp; Илья Кантор</li><li class="page-footer__item page-footer__item_about"><a class="page-footer__link" href="about.html">о проекте</a></li><li class="page-footer__item page-footer__item_contact"><a class="page-footer__link" href="about.html#contact-us">связаться с нами</a></li><li class="page-footer__item page-footer__item_terms"><a class="page-footer__link" href="terms.html">пользовательское соглашение</a></li><li class="page-footer__item page-footer__item_privacy"><a class="page-footer__link" href="privacy.html">политика конфиденциальности</a></li></ul></div></body>
<!-- Mirrored from learn.javascript.ru/garbage-collection by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 01 Apr 2023 11:30:55 GMT -->
</html>